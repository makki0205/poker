# Poker Tournament Game Requirements (Node.js + Hono + Vite)

## 1. 目的
Node.js（Hono）を使ったサーバーと、Viteを使ったフロントエンドで、
**トーナメント形式のポーカー対戦ゲーム**を構築する。

本READMEは、実装前の要件定義と、詳細ドキュメントの入口を整理するためのドキュメント。

## 2. スコープ
- 対象: Webブラウザで遊べるポーカーゲーム
- 形式: トーナメント（1卓固定）
- 利用技術
  - Backend: Node.js + Hono
  - Frontend: Vite（想定: TypeScript + 任意UIライブラリ）
  - 通信: HTTP + リアルタイム通信（WebSocket想定）

## 3. ゴール（MVP）
- プレイヤーがトーナメントに参加できる
- 卓でハンドを進行できる（配札、ベット、ショーダウン、ポット配分）
- ブラインド進行を含むトーナメント進行ができる
- 勝者が決定される
- 観戦者が進行をリアルタイムで閲覧できる

## 4. 前提ルール（確定）
> 暫定事項は後述「12. 現時点の実装前提（暫定）」で管理する。

- ゲーム種別: テキサスホールデム（No Limit）
- テーブル数: 1卓のみ
- 最大人数: 9-max
- 開始スタック: 固定
- 参加方式: 人間 + Bot参加あり
- 認証: 名前入力のみ（簡易認証）
- ブラインド: トーナメント時間 `30分 / 60分 / 90分` から選択し、選択時間に対応したブラインド構造を適用
- アンティ: あり
- アクション制限: フォールド / コール / ベット / レイズ / オールイン
- アクション時間: 無制限（タイムアウトなし）
- リバイ: あり（無制限）
- アドオン: なし
- 観戦機能: あり
- 永続化: メモリのみ（再起動で消える）
- 対応デバイス: モバイルのみ

## 5. 機能要件

### 5.1 ユーザー/認証
- プレイヤー名を入力して参加（MVPでは簡易認証）
- セッション継続（再接続時の復帰）
- 観戦者として参加可能（読み取り専用）

### 5.2 トーナメント管理
- トーナメント作成
- 参加受付（定員まで）
- 開始前にトーナメント時間（30/60/90分）を選択
- 開始条件を満たしたら開始
- レベル（ブラインド）進行
- 脱落管理
- リバイ受付・反映
- 最終勝者決定

### 5.3 テーブル/ハンド進行
- ボタン位置管理
- SB/BB徴収
- アンティ徴収
- カード配布（乱数・シャッフル）
- ベッティングラウンド進行（プリフロップ/フロップ/ターン/リバー）
- アクション順制御（タイムアウトなし）
- ショーダウン
- ハンド評価・勝敗判定
- サイドポット対応

### 5.4 リアルタイム同期
- ゲーム状態を全プレイヤーに即時反映
- ゲーム状態を観戦者にも即時反映
- 切断/再接続時に状態復元
- 不正な操作（順番外アクションなど）のサーバー側拒否

### 5.5 画面（MVP）
- ロビー画面
  - トーナメント作成
  - トーナメント時間選択（30/60/90分）
  - 参加
  - Bot人数指定
  - 観戦参加
- テーブル画面
  - 自分の手札
  - 共通カード
  - 各プレイヤーのチップ量/状態
  - アクションUI
  - ポット情報
  - 観戦モードUI（アクション不可）
- 結果画面
  - 順位
  - 勝者表示

## 6. 非機能要件
- 公平性
  - サーバー権威でゲーム進行
  - 乱数の偏りを避ける
- 信頼性
  - 切断復帰
  - 例外時にゲームが破綻しない
- パフォーマンス
  - 1卓あたり同時参加者（最大9席 + 観戦者）で遅延が体感少ない
- 保守性
  - ルールロジックと通信/画面を分離
- 運用前提
  - メモリ保持のみのため、サーバー再起動時は進行中トーナメントを復元しない
- UI前提
  - モバイル専用レイアウトを提供する

## 7. 想定アーキテクチャ（草案）
- `apps/server` (Hono)
  - Tournament Service
  - Table Engine（状態遷移）
  - Hand Evaluator
  - Realtime Gateway（WebSocket）
- `apps/client` (Vite)
  - Lobby UI
  - Table UI
  - State同期クライアント
- 詳細は `docs/ARCHITECTURE.md` を参照

## 8. データ要件（草案）
- Player
  - id, name, stack, status(active/busted/disconnected)
- Tournament
  - id, status(waiting/running/finished), blindLevel, startAt
- Table
  - id, tournamentId, seatStates, dealerPosition
- Hand
  - id, tableId, phase, pot, boardCards, actionHistory

## 9. 受け入れ基準（MVP）
- 参加したプレイヤー全員で、トーナメント開始から勝者決定まで進行できる
- 作成時に指定したBot人数を含む構成で進行できる
- ベット進行と勝敗判定がルール通りに動く
- 切断後に再接続して同一ゲームへ復帰できる
- 観戦者が進行状態をリアルタイムで閲覧できる
- トーナメント時間を `30/60/90分` から選択でき、選択内容に応じてブラインド進行が変わる
- モバイル画面で主要操作（参加/アクション/観戦）が完結する
- 最低限のログで、ハンド履歴を追跡できる

## 10. 拡張開発方針
- 機能単位でフォルダを分割し、責務を明確に保つ
- サーバーのドメインロジックはフレームワーク依存を避ける
- HTTP/WSのI/Oとルールロジックを分離する
- 共有型は `packages/shared` に集約し、クライアント・サーバーで再利用する
- 仕様変更は `docs/` を先に更新し、実装と同時に反映する

## 11. 詳細ドキュメント
- アーキテクチャ: `docs/ARCHITECTURE.md`
- API仕様: `docs/API_SPEC.md`
- テスト計画: `docs/TEST_PLAN.md`

## 12. 現時点の実装前提（暫定）
- ブラインド構造は `30/60/90分` ごとに固定テーブルで管理する
- リバイは回数無制限で受け付ける
- Botは指定人数を開始時に投入し、MVPでは簡易戦略（ルールベース）とする

## 13. 次ステップ
- ブラインド固定テーブルの数値調整とゲームバランス検証
- Bot戦略を難易度別に分離（easy/normal/hard）
- E2Eテスト（Playwright）をCIに統合

## 14. 実装ステータス
- `apps/server`: Hono API + WebSocket + インメモリトーナメント進行ロジックを実装済み
- `apps/client`: Vite + React でモバイル向けロビー/テーブル/結果画面を実装済み
- `packages/shared`: API/WS/ドメイン型とスキーマを実装済み
- テスト: Unit/Integration/UIテストを実装し、`npm run test` で全件成功

## 15. 実行方法
1. 依存関係をインストール
   - `npm install`
2. サーバー起動
   - `npm run dev:server`
3. クライアント起動（別ターミナル）
   - `npm run dev:client`
4. 品質チェック
   - `npm run typecheck`
   - `npm run test`
   - `npm run build`

## 16. CORS設定
- APIの許可オリジンは `CORS_ORIGINS` で指定可能（カンマ区切り）
- 例: `CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173`
